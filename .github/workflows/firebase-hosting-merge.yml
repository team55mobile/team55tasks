# This file was auto-generated by the Firebase CLI
# https://github.com/firebase/firebase-tools

# –∫–∞–∫ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è —Ä–∞–±–æ—Ç–∞
# 1. –≤—Å–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è –≤ –æ—Å–Ω–æ–≤–Ω—É—é –≤–µ—Ç–∫—É (—Ñ–∏–ª—å—Ç—Ä—É–µ—Ç—Å—è - —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞)
#    –ø–æ—Å–ª–µ –∫–æ–º–º–∏—Ç–∞ –¥–µ–ª–∞–µ—Ç—Å—è —Ç–µ—Å—Ç–æ–≤–∞—è —Å–±–æ—Ä–∫–∞
#   - –≤–æ–∑–º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø—É–ª–ª—Ä–µ–∫–≤–µ—Å—Ç—ã (—Ç–µ—Å—Ç—ã –∏ —Å—Ç–∏–ª—å) 
#   - –ø–æ—Å–ª–µ –ø—É–ª–ª—Ä–µ–∫–≤–µ—Å—Ç–∞ –≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ –æ—Å–Ω–æ–≤–Ω—É—é –≤–µ—Ç–∫—É
# 2. –¥–ª—è —Å–±–æ—Ä–∫–∏ —Ä–µ–ª–∏–∑–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è —Ç–µ–≥ stg_xxx, prod_xxx
#   - –∏–ª–∏ –∫–æ–º–º–∏—Ç –≤ –Ω—É–≤—É—é –≤–µ—Ç–∫—É (—á—Ç–æ –±—ã –≤–Ω–æ—Å–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –Ω–µ–µ?)

# –æ—Å–Ω–æ–≤–Ω–æ–π —Ä–æ–ª—å—é workflow –±—É–¥–µ—Ç —É—Å–ª–æ–∂–Ω–µ–Ω–∏–µ –ø–æ–ª–æ–º–∫–∏ –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã. 
# –í –æ—Å–Ω–æ–≤–Ω—É—é –≤–µ—Ç–∫—É –Ω–µ –¥–æ–ª–∂–µ–Ω –ø–æ–ø–∞—Å—Ç—å –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è, —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏–ª–∏ –ª–æ–º–∞–µ—Ç —Ç–µ—Å—Ç—ã.

name: Deploy to Firebase Hosting on merge
on:
  create:
    tags:
      - 'stg_*'
  # pull_request:
  #   branches:
  #    - "dev/sprint-**"
  # push:
  #   branches:
  #     - master
  #   tags:
  #     - 'stg_*'
  # Allows you to run this workflow manually from the Actions tab
  # workflow_dispatch:
jobs:
  build_and_deploy:
    name: build and publish web version
    #ubuntu-latest, but you can also use windows-latest or macos-11. 
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: subosito/flutter-action@v1
        with:
          channel: 'stable'
      # - run: npm ci && npm run build
      - run: flutter pub get
      - run: flutter config --enable-web
      - run: flutter build web
      - uses: FirebaseExtended/action-hosting-deploy@v0
        with:
          repoToken: '${{ secrets.GITHUB_TOKEN }}'
          firebaseServiceAccount: '${{ secrets.FIREBASE_SERVICE_ACCOUNT_TEAM55TASKS }}'
          channelId: live
          projectId: team55tasks
      # build ANDROID    
    
  build_android:  
    name: build for android
    runs-on: ubuntu-latest
    env:
      JAVA_VERSION: "12.x"
      FLUTTER_VERSION: "2.10.3"
    steps:
      - name: "üéâ Checkout files"
        uses: actions/checkout@v2
      - uses: actions/setup-java@v1
        with:
          java-version: '${{ env.JAVA_VERSION }}'
      - uses: subosito/flutter-action@v2
        with:
          flutter-version: '${{ env.FLUTTER_VERSION }}'
      - run: flutter pub get
      # - run: flutter analyze
      # - run: flutter test
      - name: "üéâ Build reliase APK"
        run: flutter build apk --release
          # env:
          #   STORE_PASSWORD: ${{ secrets.STORE_PASSWORD }}
          #   KEY_PASSWORD: ${{ secrets.KEY_PASSWORD }}
          #   KEY_ALIAS: ${{ secrets.KEY_ALIAS }}
          #   STORE_FILE: ${{ secrets.STORE_FILE }}
      # push apk to build page (add tag stg_1.0.0 git push --tags -f)
      - name: "üéâ Upload to github reliases"
        uses: ncipollo/release-action@v1
        with:
        #  artifacts: "build/app/outputs/flutter-apk/*.apk"
         artifacts: "build/app/outputs/flutter-apk/app-release.apk"
         #  token: $
         token: ${{ secrets.GITHUB_TOKEN }}
      # Upload to Firebase Distribution
      #  https://developers.google.com/android/guides/client-auth
      # - name: "üéâ Upload artifact to Firebase App Distribution com.team55mobile.team55tasks"
      #   uses: wzieba/Firebase-Distribution-Github-Action@v1
      #   with:
      #     appId: ${{ secrets.FIREBASE_ANDROID_PROD_APP_ID }}
      #     token: ${{ secrets.FIREBASE_TOKEN }}
      #     groups: testers
      #     file: build/app/outputs/apk/dev/debug/apk_name.apk
      #     debug: true



# name: GitHub Actions Demo
# on: [push]
# jobs:
#   Explore-GitHub-Actions:
#     runs-on: ubuntu-latest
#     steps:
#       - run: echo "üéâ The job was automatically triggered by a $ event."
#       - run: echo "üêß This job is now running on a $ server hosted by GitHub!"
#       - run: echo "üîé The name of your branch is $ and your repository is $."
#       - name: Check out repository code
#         uses: actions/checkout@v2
#       - run: echo "üí° The $ repository has been cloned to the runner."
#       - run: echo "üñ•Ô∏è The workflow is now ready to test your code on the runner."
#       - name: List files in the repository
#         run: |
#           ls $
#       - run: echo "üçè This job's status is $."